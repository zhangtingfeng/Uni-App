var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;import{_ as s,ap as l,ac as c,al as d,ai as p,$ as u,s as f,o as h,c as g,w as m,a as w,b as y,r as b,d as v,e as O,f as P,i as x,I}from"./index.fb84ef13.js";var _=s({data:()=>({title:"request-payment",loading:!1,price:1,providerList:[]}),onLoad:function(){},methods:{loginMpWeixin:()=>new Promise(((e,t)=>{l({provider:"weixin",success(a){console.warn("此处使用uni-id处理微信小程序登录，详情参考: https://uniapp.dcloud.net.cn/uniCloud/uni-id"),c({url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/user-center",method:"POST",data:{action:"loginByWeixin",params:{code:a.code,platform:"mp-weixin"}},success(a){0===a.data.code?(d("openid",a.data.openid),e(a.data.openid)):t(new Error("获取openid失败：",a.result.msg))},fail(e){t(new Error("获取openid失败："+e))}})},fail(e){t(e)}})})),async weixinPay(){let e=p("openid");if(console.log("发起支付"),this.loading=!0,!e){try{e=await this.loginMpWeixin()}catch(c){console.error(c)}if(!e)return u({content:"获取openid失败",showCancel:!1}),void(this.loading=!1)}this.openid=e;let s=await this.getOrderInfo("wxpay");var l;s?uni.requestPayment((l=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(n)for(var a of n(t))i.call(t,a)&&r(e,a,t[a]);return e})({},s),t(l,a({success:e=>{f({title:"感谢您的赞助!"})},fail:e=>{u({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.loading=!1}})))):u({content:"获取支付信息失败",showCancel:!1})},async requestPayment(e,t){this.providerList[t].loading=!0;const a=e.id;let n=await this.getOrderInfo(a);n?(console.log("--------orderInfo--------"),console.log(n),uni.requestPayment({provider:a,orderInfo:n,success:e=>{console.log("success",e),f({title:"感谢您的赞助!"})},fail:e=>{console.log("fail",e),u({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.providerList[t].loading=!1}})):u({content:"获取支付信息失败",showCancel:!1})},getOrderInfo(e){return new Promise(((t,a)=>{this.price||a(new Error("请输入金额")),console.warn("此处使用uni-pay处理支付，详情参考: https://uniapp.dcloud.io/uniCloud/unipay"),c({method:"POST",url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/pay",data:{provider:e,openid:this.openid,totalFee:100*Number(this.price)},success(e){0===e.data.code?t(e.data.orderInfo):a(new Error("获取支付信息失败"+e.data.msg))},fail(e){a(new Error("请求支付接口失败"+e))}})}))},priceChange(e){console.log(e.detail.value),this.price=e.detail.value}}},[["render",function(e,t,a,n,o,i){const r=b(O("page-head"),v),s=P,l=x,c=I;return h(),g(l,null,{default:m((()=>[w(r,{title:o.title},null,8,["title"]),w(l,{class:"uni-padding-wrap"},{default:m((()=>[w(l,{style:{background:"#FFF",padding:"50rpx 0"}},{default:m((()=>[w(l,{class:"uni-hello-text uni-center"},{default:m((()=>[w(s,null,{default:m((()=>[y("支付金额")])),_:1})])),_:1}),w(l,{class:"uni-h1 uni-center uni-common-mt"},{default:m((()=>[w(s,{class:"rmbLogo"},{default:m((()=>[y("￥")])),_:1}),w(c,{class:"price",type:"digit",value:o.price,maxlength:"4",onInput:i.priceChange},null,8,["value","onInput"])])),_:1})])),_:1}),w(l,{class:"uni-btn-v uni-common-mt"})])),_:1})])),_:1})}],["__scopeId","data-v-0483dbce"]]);export{_ as default};
